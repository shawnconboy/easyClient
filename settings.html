<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings – Easy Client</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <h2>Easy Client</h2>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="companies.html">Companies</a>
                <a href="#">Users</a>
                <a href="settings.html" class="active">Settings</a>
                <a href="landing.html">Landing Page</a>
            </nav>
        </aside>
        <main class="main">
            <header class="topbar">
                <h1>Settings</h1>
                <div class="user-box" id="user-box"
                    style="margin-left:auto; display:flex; align-items:center; gap:1em;">
                    <button id="auth-btn" title="Sign in">
                        Sign In
                    </button>
                </div>
                <!-- User modal -->
                <div id="user-modal" class="user-modal">
                    <div class="user-modal-inner">
                        <div id="user-modal-email" class="user-modal-email"></div>
                        <button id="logout-btn" class="logout-btn">Log Out</button>
                    </div>
                </div>
            </header>
            <section class="content">
                <h2>Settings</h2>
                <div class="settings-placeholder section-space">
                    <p>
                        Settings page placeholder.<br>
                        Here you’ll be able to manage your account, preferences, and app configuration.
                    </p>
                </div>
            </section>
        </main>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA9iKdL-7YCBWrqbBmLFkw--pS0kET7qZc",
            authDomain: "easyclient-ac627.firebaseapp.com",
            projectId: "easyclient-ac627",
            storageBucket: "easyclient-ac627.firebasestorage.app",
            messagingSenderId: "247790149498",
            appId: "1:247790149498:web:6d03859eaa5394f17fc0c3",
            measurementId: "G-SF966FYKGB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const authBtn = document.getElementById('auth-btn');
        const userModal = document.getElementById('user-modal');
        const userModalEmail = document.getElementById('user-modal-email');
        const logoutBtn = document.getElementById('logout-btn');
        let userEmail = "";

        function showUserModal() {
            userModal.style.display = 'block';
            userModalEmail.textContent = userEmail;
            setTimeout(() => {
                document.addEventListener('mousedown', handleOutsideClick);
            }, 0);
        }
        function hideUserModal() {
            userModal.style.display = 'none';
            document.removeEventListener('mousedown', handleOutsideClick);
        }
        function handleOutsideClick(e) {
            if (!userModal.contains(e.target) && e.target !== authBtn) {
                hideUserModal();
            }
        }

        onAuthStateChanged(auth, async user => {
            if (user) {
                let displayName = user.displayName;
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists() && userDoc.data().name) {
                        displayName = userDoc.data().name;
                    }
                } catch { }
                userEmail = user.email;
                authBtn.textContent = displayName || user.email;
                authBtn.title = "Account";
                authBtn.style.background = "#1976d2";
                authBtn.style.color = "#fff";
                authBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (userModal.style.display === 'block') {
                        hideUserModal();
                    } else {
                        showUserModal();
                    }
                };
                logoutBtn.onclick = async () => {
                    await signOut(auth);
                    hideUserModal();
                };
            } else {
                userEmail = "";
                authBtn.textContent = "Sign In";
                authBtn.title = "Sign in";
                authBtn.onclick = () => {
                    window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname + window.location.search)}`;
                };
                authBtn.style.background = "#1976d2";
                authBtn.style.color = "#fff";
                hideUserModal();
            }
        });
    </script>
</body>

</html>