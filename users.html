<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users - Easy Client</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        .users-header {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 2fr;
            gap: 1em;
            background: #f7f7f7;
            font-weight: 600;
            color: #1976d2;
            padding: 1em 1.5em;
            border-radius: 10px;
            margin-top: 2em;
            margin-bottom: 0.5em;
            box-shadow: 0 1px 4px rgba(25, 118, 210, 0.06);
        }

        .users-list {
            display: flex;
            flex-direction: column;
            gap: 0.7em;
        }

        .user-card {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 2fr;
            gap: 1em;
            align-items: center;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(25, 118, 210, 0.06);
            padding: 0.8em 1.5em;
            font-size: 1em;
            transition: box-shadow 0.2s;
        }

        .user-card:hover {
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.10);
        }

        @media (max-width: 700px) {
            .users-header {
                display: none !important;
            }

            .user-card {
                display: flex;
                flex-direction: column;
                gap: 0.5em;
                padding: 1em;
            }

            .user-card>div {
                width: 100%;
                display: flex;
                flex-direction: column;
            }

            .user-card-label {
                font-size: 0.95em;
                color: #1976d2;
                font-weight: 600;
                margin-bottom: 0.2em;
                display: block;
            }
        }

        @media (min-width: 701px) {
            .user-card-label {
                display: none;
            }
        }

        .user-box {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 1em;
        }

        .user-modal {
            display: none;
            position: absolute;
            right: 1.5em;
            top: 3.5em;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .user-modal-inner {
            padding: 1em;
            display: flex;
            flex-direction: column;
            gap: 0.5em;
        }

        .logout-btn {
            background: #d32f2f;
            color: #fff;
            border: none;
            padding: 0.5em 1em;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c62828;
        }
    </style>
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <h2>Easy Client</h2>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="companies.html">Companies</a>
                <a href="users.html" class="active">Users</a>
                <a href="settings.html">Settings</a>
                <a href="landing.html">Landing Page</a>
            </nav>
        </aside>
        <main class="main">
            <header class="topbar">
                <h1>Users</h1>
                <div class="user-box" id="user-box">
                    <button id="auth-btn" title="Sign in">
                        Sign In
                    </button>
                </div>
                <!-- User modal -->
                <div id="user-modal" class="user-modal">
                    <div class="user-modal-inner">
                        <div id="user-modal-email" class="user-modal-email"></div>
                        <button id="logout-btn" class="logout-btn">Log Out</button>
                    </div>
                </div>
            </header>
            <section class="content">
                <div class="users-header" id="users-header"
                    style="display:grid; align-items:center; position:relative;">
                    <div>Company Name</div>
                    <div>Owner Name</div>
                    <div>Owner Phone</div>
                    <div>Owner Email</div>
                    <span id="company-count"
                        style="position:absolute; right:1.5em; top:1em; color:#1976d2; font-weight:500; font-size:1em;"></span>
                </div>
                <div class="users-list" id="users-list">
                    <!-- User cards will be rendered here -->
                </div>
            </section>
        </main>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA9iKdL-7YCBWrqbBmLFkw--pS0kET7qZc",
            authDomain: "easyclient-ac627.firebaseapp.com",
            projectId: "easyclient-ac627",
            storageBucket: "easyclient-ac627.firebasestorage.app",
            messagingSenderId: "247790149498",
            appId: "1:247790149498:web:6d03859eaa5394f17fc0c3",
            measurementId: "G-SF966FYKGB"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const authBtn = document.getElementById('auth-btn');
        const userModal = document.getElementById('user-modal');
        const userModalEmail = document.getElementById('user-modal-email');
        const logoutBtn = document.getElementById('logout-btn');
        let userEmail = "";

        function showUserModal() {
            userModal.style.display = 'block';
            userModalEmail.textContent = userEmail;
            setTimeout(() => {
                document.addEventListener('mousedown', handleOutsideClick);
            }, 0);
        }
        function hideUserModal() {
            userModal.style.display = 'none';
            document.removeEventListener('mousedown', handleOutsideClick);
        }
        function handleOutsideClick(e) {
            if (!userModal.contains(e.target) && e.target !== authBtn) {
                hideUserModal();
            }
        }

        onAuthStateChanged(auth, async user => {
            if (user) {
                let displayName = user.displayName;
                try {
                    const userDoc = await getDocs(collection(db, "users"));
                    // ...optional: fetch displayName from userDoc if needed...
                } catch { }
                userEmail = user.email;
                authBtn.textContent = displayName || user.email;
                authBtn.title = "Account";
                authBtn.style.background = "#1976d2";
                authBtn.style.color = "#fff";
                authBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (userModal.style.display === 'block') {
                        hideUserModal();
                    } else {
                        showUserModal();
                    }
                };
                logoutBtn.onclick = async () => {
                    await signOut(auth);
                    hideUserModal();
                };
            } else {
                userEmail = "";
                authBtn.textContent = "Sign In";
                authBtn.title = "Sign in";
                authBtn.onclick = () => {
                    window.location.href = `login.html?redirect=${encodeURIComponent(window.location.pathname + window.location.search)}`;
                };
                authBtn.style.background = "#1976d2";
                authBtn.style.color = "#fff";
                hideUserModal();
            }
        });

        async function renderUsers() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            const companiesSnap = await getDocs(collection(db, 'companies'));
            let count = 0;
            companiesSnap.forEach(docSnap => {
                count++;
                const company = docSnap.data();
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `
                    <div>
                        <span class="user-card-label">Company Name</span>
                        <span>${company.name || ''}</span>
                    </div>
                    <div>
                        <span class="user-card-label">Owner Name</span>
                        <span>${company.ownerName || company.owner || ''}</span>
                    </div>
                    <div>
                        <span class="user-card-label">Owner Phone</span>
                        <span>${company.ownerPhone || ''}</span>
                    </div>
                    <div>
                        <span class="user-card-label">Owner Email</span>
                        <span>${company.ownerEmail || ''}</span>
                    </div>
                `;
                usersList.appendChild(card);
            });
            document.getElementById('company-count').textContent = `Total: ${count}`;
        }
        renderUsers();
    </script>
</body>

</html>